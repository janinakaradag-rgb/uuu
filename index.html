<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Ожившая фотография (камера)</title>

<style>
  html, body { margin: 0; height: 100%; overflow: hidden; background: #000; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

  /* Оверлей старта (нужен, чтобы браузер разрешил камеру) */
  #startOverlay{
    position: fixed; inset: 0;
    display: grid; place-items: center;
    background: rgba(0,0,0,.65);
    color: #fff;
    z-index: 9999;
    padding: 20px;
    text-align: center;
  }
  #startOverlay button{
    margin-top: 14px;
    padding: 12px 16px;
    border: 0;
    border-radius: 14px;
    background: rgba(255,255,255,.14);
    color: #fff;
    font-size: 16px;
    cursor: pointer;
  }

  #hint{
    position: fixed;
    left: 12px; right: 12px; bottom: 12px;
    z-index: 9998;
    color: rgba(255,255,255,.92);
    font-size: 14px;
    background: rgba(0,0,0,.35);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    padding: 10px 12px;
    backdrop-filter: blur(6px);
  }
</style>

<!-- A-Frame -->
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<!-- MindAR for A-Frame -->
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>

<body>

<div id="startOverlay">
  <div>
    <div style="font-size:18px; line-height:1.35;">
      Нажмите «Запустить камеру», затем наведите на эту фотографию.
    </div>
    <button id="startBtn">Запустить камеру</button>
    <div style="margin-top:10px; font-size:13px; opacity:.85;">
      Если браузер спросит доступ к камере — разрешите.
    </div>
  </div>
</div>

<div id="hint">Наводите камеру на фотографию. Когда распознается — видео появится поверх фото.</div>

<a-scene
  mindar-image="imageTargetSrc: target.mind; autoStart: false; uiLoading: no; uiError: no; uiScanning: no;"
  color-space="sRGB"
  renderer="colorManagement: true; physicallyCorrectLights: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <!-- Камера + курсор (на будущее, если захотите тап по цели) -->
  <a-entity
    camera
    position="0 0 0"
    look-controls="enabled: false"
    cursor="rayOrigin: mouse; fuse: false"
    raycaster="objects: .tapTarget">
  </a-entity>

  <a-assets>
    <!-- ВАШЕ ВИДЕО -->
    <video id="vid" src="123456.mp4" preload="auto" loop muted playsinline webkit-playsinline></video>
  </a-assets>

  <!-- ЯКОРЬ №0 = первая картинка в target.mind (это и есть ваша фотография-маркер) -->
  <a-entity mindar-image-target="targetIndex: 0">

    <!-- ВИДЕО ПОВЕРХ ФОТО -->
    <a-video
      id="videoPlane"
      src="#vid"
      width="1"
      height="0.75"
      position="0 0 0"
      rotation="0 0 0"
      material="transparent: true"
      visible="false">
    </a-video>

    <!-- Прозрачная плоскость (если захотите “тап, чтобы включить”) -->
    <a-plane
      id="tapPlane"
      class="tapTarget"
      width="1"
      height="0.75"
      position="0 0 0.001"
      material="color: #FFF; opacity: 0.0; transparent: true"
      visible="false">
    </a-plane>

  </a-entity>

</a-scene>

<script>
  const sceneEl = document.querySelector('a-scene');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('startOverlay');

  const vid = document.getElementById('vid');
  const tapPlane = document.getElementById('tapPlane');
  const videoPlane = document.getElementById('videoPlane');

  startBtn.addEventListener('click', async () => {
    overlay.style.display = 'none';
    try {
      await sceneEl.components["mindar-image"].start();
    } catch (e) {
      overlay.style.display = 'grid';
      alert("Не удалось запустить камеру. Проверьте разрешения и попробуйте снова.");
    }
  });

  // Маркер найден: показываем слой для тапа (и можно автозапуск)
  sceneEl.addEventListener("targetFound", async () => {
    tapPlane.setAttribute('visible', 'true');

    // Автозапуск видео при распознавании
    videoPlane.setAttribute('visible', 'true');
    try { await vid.play(); } catch(e) { /* на некоторых телефонах нужен тап */ }
  });

  // Маркер потерян: прячем видео (по желанию можно не прятать)
  sceneEl.addEventListener("targetLost", () => {
    tapPlane.setAttribute('visible', 'false');
    videoPlane.setAttribute('visible', 'false');
    try { vid.pause(); } catch(e) {}
  });

  // Если телефон не даёт автозапуск — тап по “фото” включит
  tapPlane.addEventListener('click', async () => {
    videoPlane.setAttribute('visible', 'true');
    try { await vid.play(); } catch(e) {}
  });
</script>

</body>
</html>
